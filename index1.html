<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Delta Pemantik - SMKN Pasirian</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Import Map untuk React & Lucide -->
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "lucide-react": "https://esm.sh/lucide-react@0.263.1"
        }
    }
    </script>
    
    <!-- Babel untuk JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* Custom Styles */
        body { margin: 0; padding: 0; background-color: #020617; }
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fadeIn {
            animation: fadeIn 0.5s ease-out forwards;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
            BookOpen, Compass, Rocket, Repeat, BarChart2, Play, 
            ChevronRight, Menu, User, Award, Terminal, Wifi, 
            Ruler, LogIn, Sparkles, X as CloseIcon, MessageSquare, 
            LogOut, Settings, ChevronDown, LayoutGrid, LayoutList, 
            Clock, CheckCircle2, MoreHorizontal, Globe, Lock, 
            FileText, Video, HelpCircle, Bell, GraduationCap, Mail, Phone, Calendar,
            Megaphone, AlertCircle, Pin, CalendarDays, Map, Send, Loader2
        } from 'lucide-react';

        // --- SUB COMPONENTS (Moved outside App for stability) ---

        const TeacherProfile = () => (
            <div className="p-4 md:p-8 h-full overflow-y-auto pb-24 md:pb-0">
                <div className="bg-gradient-to-r from-slate-900 to-slate-800 rounded-2xl border border-slate-700 overflow-hidden relative mb-6">
                    <div className="absolute top-0 w-full h-32 bg-gradient-to-r from-blue-900/50 to-purple-900/50"></div>
                    <div className="p-6 relative pt-16 md:pt-20">
                        <div className="flex flex-col md:flex-row items-start md:items-end gap-4">
                            <div className="w-24 h-24 rounded-2xl bg-slate-700 border-4 border-slate-800 shadow-xl overflow-hidden flex items-center justify-center">
                                <img 
                                    src="https://i.ibb.co.com/x82PbSjy/IMG-20250927-210909.png" 
                                    alt="Feri Dwi Hermawan" 
                                    className="w-full h-full object-cover"
                                />
                            </div>
                            <div className="flex-1">
                                <div className="flex items-center gap-2 mb-1">
                                    <h2 className="text-2xl font-bold text-white">Feri Dwi Hermawan, S.Pd.</h2>
                                    <span className="bg-blue-500/20 text-blue-300 text-[10px] px-2 py-0.5 rounded border border-blue-500/30">Verified Teacher</span>
                                </div>
                                <p className="text-slate-400 text-sm mb-3">Guru Matematika â€¢ SMKN Pasirian</p>
                                <div className="flex flex-wrap gap-2">
                                    <span className="bg-slate-800 text-slate-300 px-3 py-1 rounded-full text-xs border border-slate-700">RPL</span>
                                    <span className="bg-slate-800 text-slate-300 px-3 py-1 rounded-full text-xs border border-slate-700">TKJ</span>
                                    <span className="bg-slate-800 text-slate-300 px-3 py-1 rounded-full text-xs border border-slate-700">DPIB</span>
                                </div>
                            </div>
                            <div className="flex gap-2 w-full md:w-auto mt-4 md:mt-0">
                                <button 
                                    onClick={() => window.open('https://wa.me/6285174244128', '_blank')}
                                    className="flex-1 md:flex-none bg-green-600 hover:bg-green-500 text-white px-4 py-2 rounded-lg text-sm font-bold flex items-center justify-center gap-2 transition-colors"
                                >
                                    <MessageSquare className="w-4 h-4" /> Chat WA
                                </button>
                                <button 
                                    onClick={() => window.open('https://t.me/ferilee', '_blank')}
                                    className="flex-1 md:flex-none bg-slate-700 hover:bg-slate-600 text-white px-4 py-2 rounded-lg text-sm font-bold flex items-center justify-center gap-2 transition-colors"
                                >
                                    <Send className="w-4 h-4" /> Telegram
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );

        const AnnouncementsView = () => {
            const announcements = [
                { id: 1, title: "Jadwal Penilaian Akhir Semester (PAS)", category: "Akademik", date: "5 Jan 2026", desc: "Ujian akan dilaksanakan mulai tanggal 15 Januari. Pastikan semua tugas DELTA tahap Launch sudah dikumpulkan.", urgent: true },
                { id: 2, title: "Deadline Proyek Statistika Diperpanjang", category: "Tugas", date: "4 Jan 2026", desc: "Untuk kelas X TKJ, deadline proyek analisis bandwidth diperpanjang hingga Jumat depan.", urgent: false },
                { id: 3, title: "Lomba Matematika Terapan Vokasi", category: "Prestasi", date: "2 Jan 2026", desc: "Pendaftaran dibuka untuk lomba tingkat provinsi. Hubungi Pak Feri jika berminat bimbingan.", urgent: false },
                { id: 4, title: "Libur Hari Raya", category: "Info", date: "1 Jan 2026", desc: "Sekolah libur pada tanggal merah. Gunakan waktu untuk istirahat atau refleksi mandiri.", urgent: false },
            ];

            const getCategoryColor = (cat) => {
                switch(cat) {
                    case 'Akademik': return 'red';
                    case 'Tugas': return 'yellow';
                    case 'Prestasi': return 'purple';
                    default: return 'blue';
                }
            };

            return (
                <div className="p-4 pt-20 md:p-8 md:pt-8 h-full overflow-y-auto pb-24 md:pb-0">
                    <div className="flex items-center justify-between mb-6">
                        <div>
                            <h2 className="text-2xl font-bold text-white flex items-center gap-3">
                                <Megaphone className="w-6 h-6 text-orange-500" /> Papan Pengumuman
                            </h2>
                            <p className="text-slate-400 text-sm mt-1">Info terbaru seputar akademik dan kegiatan sekolah.</p>
                        </div>
                    </div>

                    <div className="mb-8">
                        <h3 className="text-sm font-bold text-slate-400 uppercase tracking-widest mb-3 flex items-center gap-2">
                            <Pin className="w-4 h-4" /> Disematkan
                        </h3>
                        {announcements.filter(a => a.urgent).map(item => (
                            <div key={item.id} className="bg-gradient-to-r from-red-900/40 to-slate-900 border border-red-500/30 rounded-xl p-6 relative overflow-hidden shadow-lg">
                                <div className="absolute top-0 right-0 p-3 opacity-10">
                                    <AlertCircle className="w-24 h-24 text-red-500" />
                                </div>
                                <div className="relative z-10">
                                    <span className="inline-block bg-red-500 text-white text-[10px] font-bold px-2 py-1 rounded mb-2">PENTING</span>
                                    <h3 className="text-xl font-bold text-white mb-2">{item.title}</h3>
                                    <p className="text-slate-300 text-sm mb-4 max-w-2xl">{item.desc}</p>
                                    <div className="flex items-center gap-2 text-slate-400 text-xs">
                                        <CalendarDays className="w-4 h-4" /> {item.date}
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>

                    <div>
                        <h3 className="text-sm font-bold text-slate-400 uppercase tracking-widest mb-4">Terbaru</h3>
                        <div className="space-y-4">
                            {announcements.filter(a => !a.urgent).map((item, idx) => (
                                <div key={item.id} className="flex gap-4 group">
                                    <div className="flex flex-col items-center">
                                        <div className={`w-3 h-3 rounded-full bg-${getCategoryColor(item.category)}-500 mt-2 ring-4 ring-slate-900`}></div>
                                        {idx !== announcements.length - 1 && <div className="w-0.5 h-full bg-slate-800 my-2"></div>}
                                    </div>
                                    <div className="flex-1 bg-slate-900 border border-slate-800 p-4 rounded-xl hover:border-slate-700 transition-colors">
                                        <div className="flex justify-between items-start mb-2">
                                            <span className={`text-[10px] font-bold px-2 py-0.5 rounded bg-${getCategoryColor(item.category)}-900/30 text-${getCategoryColor(item.category)}-400 border border-${getCategoryColor(item.category)}-500/20`}>
                                                {item.category}
                                            </span>
                                            <span className="text-[10px] text-slate-500">{item.date}</span>
                                        </div>
                                        <h4 className="text-white font-bold text-sm mb-1">{item.title}</h4>
                                        <p className="text-slate-400 text-xs leading-relaxed">{item.desc}</p>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        // --- MAIN APP COMPONENT ---

        const App = () => {
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [userName, setUserName] = useState('');
            const [userClass, setUserClass] = useState('X TKJ A');
            
            // Login states
            const [studentData, setStudentData] = useState([]);
            const [classList, setClassList] = useState([]);
            const [availableNames, setAvailableNames] = useState([]);
            const [selectedClassLogin, setSelectedClassLogin] = useState('');
            const [selectedNameLogin, setSelectedNameLogin] = useState('');
            const [inputPassword, setInputPassword] = useState('');
            const [loginError, setLoginError] = useState('');
            const [isDataLoading, setIsDataLoading] = useState(true);

            const [activeTab, setActiveTab] = useState('dashboard');
            const [viewMode, setViewMode] = useState('stream'); 
            const [selectedMajor, setSelectedMajor] = useState('TKJ'); 
            const [selectedLevel, setSelectedLevel] = useState('X'); 
            const [selectedTopic, setSelectedTopic] = useState(''); 
            const [activeDeltaStage, setActiveDeltaStage] = useState('Launch'); 

            // States
            const [showAIModal, setShowAIModal] = useState(false);
            const [aiLoading, setAiLoading] = useState(false);
            const [aiResponse, setAiResponse] = useState('');
            const [aiPromptType, setAiPromptType] = useState(''); 
            const [showActivityModal, setShowActivityModal] = useState(false);
            const [activityContent, setActivityContent] = useState(null);
            const [showAdminModal, setShowAdminModal] = useState(false);
            const [adminPassword, setAdminPassword] = useState('');
            const [adminError, setAdminError] = useState('');
            const [isTourActive, setIsTourActive] = useState(false);
            const [tourStep, setTourStep] = useState(0);

            const apiKey = "AIzaSyAS46ALiEZuE6hV3WT5qPu2IEHYZNHJyUU"; 

            // Fetch Student Data
            useEffect(() => {
                const fetchStudents = async () => {
                    try {
                        const response = await fetch('https://docs.google.com/spreadsheets/d/e/2PACX-1vRNxfl64ybd5HEX-Ln3ubR8C-SxModDRkPVuRpShlUDX2UCRgKib2cIqXtsUPT4d0rJY_gkaCQVOTSb/pub?gid=1562678039&single=true&output=csv');
                        const text = await response.text();
                        const rows = text.split('\n');
                        const data = [];
                        rows.forEach((row, index) => {
                            const cols = row.split(',').map(c => c.trim().replace(/^"|"$/g, ''));
                            if (cols.length >= 4) {
                                if (index === 0 && (cols[0].toLowerCase().includes('nama') || cols[1].toLowerCase().includes('kelas'))) return;
                                data.push({ name: cols[0], class: cols[1], major: cols[2], password: cols[3] });
                            }
                        });
                        setStudentData(data);
                        const uniqueClasses = [...new Set(data.map(s => s.class))].sort();
                        setClassList(uniqueClasses);
                    } catch (error) {
                        console.error(error);
                        setLoginError("Gagal memuat data siswa.");
                    } finally {
                        setIsDataLoading(false);
                    }
                };
                fetchStudents();
            }, []);

            // Login Logic
            const handleClassChange = (e) => {
                const cls = e.target.value;
                setSelectedClassLogin(cls);
                setSelectedNameLogin('');
                const names = studentData.filter(s => s.class === cls).map(s => s.name).sort();
                setAvailableNames(names);
            };

            const handleLogin = (e) => {
                e.preventDefault();
                setLoginError('');
                const student = studentData.find(s => s.name === selectedNameLogin && s.class === selectedClassLogin);
                if (!student) { setLoginError('Data siswa tidak valid.'); return; }
                if (student.password === inputPassword) {
                    setUserName(student.name);
                    setUserClass(student.class);
                    let major = 'TKJ';
                    const majorRaw = student.major.toUpperCase();
                    if (majorRaw.includes('RPL')) major = 'RPL';
                    else if (majorRaw.includes('DPIB')) major = 'DPIB';
                    else if (majorRaw.includes('TKJ')) major = 'TKJ';
                    setSelectedMajor(major);
                    let level = 'SENIOR';
                    if (student.class.startsWith('X ') || student.class.startsWith('X-')) level = 'X';
                    setSelectedLevel(level);
                    const defaultTopic = level === 'X' ? syllabus.X[0] : syllabus.SENIOR[0];
                    setSelectedTopic(defaultTopic);
                    setIsLoggedIn(true);
                    setTimeout(() => startTour(), 1000);
                } else {
                    setLoginError('Password salah.');
                }
            };

            const handleGuestLogin = () => {
                setUserName("Tamu (Siswa Demo)");
                setUserClass("X Demo");
                setSelectedMajor('TKJ');
                setSelectedLevel('X');
                setSelectedTopic(syllabus.X[0]);
                setIsLoggedIn(true);
                setTimeout(() => startTour(), 1000);
            };

            // Data Definitions
            const syllabus = {
                X: ["Eksponen & Pangkat Pecahan", "SP & PtLDV", "Fungsi Kuadrat", "Persamaan & Fungsi Eksponensial", "Trigonometri", "Statistika", "Peluang"],
                SENIOR: ["Barisan & Deret", "Anuitas & Investasi", "Komposisi & Invers Fungsi", "Transformasi Fungsi", "Lingkaran", "Statistika Lanjut", "Peluang Lanjutan"]
            };

            const contentDatabase = {
                X: {
                    "Eksponen & Pangkat Pecahan": {
                        RPL: { title: "Eksponen & Biner", context: "Optimasi Memori & Big Data", task: "Hitung efisiensi penyimpanan data biner (bit/byte) menggunakan sifat eksponensial.", img: "https://images.unsplash.com/photo-1555066931-4365d14bab8c?auto=format&fit=crop&q=80&w=800" },
                        TKJ: { title: "Eksponen Jaringan", context: "Subnetting & IP Address", task: "Hitung jumlah host maksimum dalam jaringan menggunakan perpangkatan basis 2.", img: "https://images.unsplash.com/photo-1558494949-ef526b0042a0?auto=format&fit=crop&q=80&w=800" },
                        DPIB: { title: "Eksponen Struktur", context: "Kekuatan Material", task: "Hitung peluruhan kekuatan beton atau pertumbuhan bakteri pada instalasi limbah.", img: "https://images.unsplash.com/photo-1503387762-592deb58ef4e?auto=format&fit=crop&q=80&w=800" }
                    },
                    // ... (Other contents would be here, truncated for brevity but logic handles fallback)
                },
                SENIOR: {
                    "Pemrograman Web": {
                        TKJ: { title: "Web & Mobile Dev", context: "Dasar Website & Apps", task: "Pelajari dasar pembuatan website responsif (HTML/CSS) dan pengenalan struktur aplikasi mobile. Terapkan logika layout grid.", img: "https://images.unsplash.com/photo-1547658719-da2b51169166?auto=format&fit=crop&q=80&w=800" }
                    }
                }
            };

            const getCurrentData = () => {
                const levelDB = contentDatabase[selectedLevel] || {};
                const topicDB = levelDB[selectedTopic];
                const specificData = topicDB ? topicDB[selectedMajor] : null;

                if (specificData) {
                    return { ...specificData, themeColor: getThemeColor(selectedMajor), accentColor: getAccentColor(selectedMajor), icon: getIcon(selectedMajor) };
                } else {
                    return {
                        title: selectedTopic || "Materi Matematika",
                        context: `Penerapan di ${selectedMajor}`,
                        task: `Selesaikan permasalahan kontekstual ${selectedTopic} yang berkaitan dengan studi kasus ${selectedMajor}.`,
                        img: getGenericImage(selectedMajor),
                        themeColor: getThemeColor(selectedMajor),
                        accentColor: getAccentColor(selectedMajor),
                        icon: getIcon(selectedMajor)
                    };
                }
            };

            const getThemeColor = (major) => major === 'RPL' ? 'blue' : major === 'TKJ' ? 'emerald' : 'orange';
            const getAccentColor = (major) => major === 'RPL' ? 'from-blue-600 to-indigo-900' : major === 'TKJ' ? 'from-emerald-600 to-teal-900' : 'from-orange-600 to-red-900';
            const getIcon = (major) => major === 'RPL' ? <Terminal className="w-5 h-5"/> : major === 'TKJ' ? <Wifi className="w-5 h-5"/> : <Ruler className="w-5 h-5"/>;
            const getGenericImage = (major) => major === 'RPL' ? "https://images.unsplash.com/photo-1517694712202-14dd9538aa97?w=800" : major === 'TKJ' ? "https://images.unsplash.com/photo-1544197150-b99a580bbcbf?w=800" : "https://images.unsplash.com/photo-1503387762-592deb58ef4e?w=800";

            const currentData = getCurrentData();

            const deltaStages = [
                { id: 'Discover', title: '1. Discover', subtitle: 'Investigasi Masalah', icon: <BookOpen className="w-4 h-4" />, kanbanStatus: 'todo' },
                { id: 'Explore', title: '2. Explore', subtitle: 'Eksperimen Konsep', icon: <Compass className="w-4 h-4" />, kanbanStatus: 'todo' },
                { id: 'Launch', title: '3. Launch', subtitle: 'Misi Utama', icon: <Rocket className="w-4 h-4" />, kanbanStatus: 'inprogress' },
                { id: 'Transform', title: '4. Transform', subtitle: 'Refleksi Diri', icon: <Repeat className="w-4 h-4" />, kanbanStatus: 'review' },
                { id: 'Assess', title: '5. Assess', subtitle: 'Uji Kompetensi', icon: <BarChart2 className="w-4 h-4" />, kanbanStatus: 'done' },
            ];

            const handleStartActivity = () => {
                const stage = activeDeltaStage;
                let content = { title: "Info", body: "Konten sedang dimuat...", icon: <HelpCircle className="w-12 h-12"/>, actionText: "Tutup" };
                
                // Content logic here (simplified for brevity, ensuring no syntax error)
                if(stage === 'Launch') content = { title: "Misi Utama", body: `Tugas: ${currentData.task}`, icon: <Rocket className="w-12 h-12 text-orange-400"/>, actionText: "Mulai" };
                else content = { title: stage, body: `Aktivitas untuk tahap ${stage}.`, icon: <BookOpen className="w-12 h-12 text-blue-400"/>, actionText: "Lanjut" };

                setActivityContent(content);
                setShowActivityModal(true);
            };

            const callGeminiAPI = async (type) => {
                setAiLoading(true);
                setAiResponse('');
                setAiPromptType(type);
                setShowAIModal(true);
                
                if (!apiKey) { setAiResponse("API Key missing."); setAiLoading(false); return; }

                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: `Explain ${currentData.title} for ${selectedMajor}` }] }] })
                    });
                    const data = await response.json();
                    if(data.candidates) setAiResponse(data.candidates[0].content.parts[0].text);
                    else setAiResponse("AI Busy.");
                } catch (e) { setAiResponse("Connection Error."); }
                finally { setAiLoading(false); }
            };

            const startTour = () => { setIsTourActive(true); setTourStep(0); };
            const handleAdminAccess = (e) => { e.preventDefault(); if(adminPassword === "F3r!-lee") window.location.href="https://feriboard.netlify.app/"; else setAdminError("Wrong Password"); };
            
            const getTopicsList = () => {
                let topics = [...(syllabus[selectedLevel] || [])];
                if (userClass.includes('XII TKJ')) topics.push("Pemrograman Web");
                return topics;
            };

            const getHighlightClass = (step) => isTourActive && tourStep === step ? "relative z-[201] ring-4 ring-indigo-500 rounded-xl box-border shadow-2xl transition-all duration-300 bg-slate-800" : "";

            // --- RENDER CONTENT ---
            const renderContent = () => {
                if (activeTab === 'teacher') return <TeacherProfile />;
                if (activeTab === 'announcements') return <AnnouncementsView />;
                
                if (viewMode === 'kanban') {
                    return (
                        <div className="p-4 md:p-8 h-full overflow-hidden flex flex-col">
                             <div className="text-white">Mode Proyek (Kanban View) - Silakan beralih ke Stream untuk tampilan utama.</div>
                        </div>
                    );
                }

                // Default Stream View
                return (
                    <div className="relative w-full h-full overflow-y-auto pb-20 md:pb-0">
                         {/* Hero Section */}
                         <div className={`relative w-full h-[500px] md:h-[60vh] overflow-hidden group ${getHighlightClass(1)}`}>
                            <img src={currentData.img} className="absolute inset-0 w-full h-full object-cover" />
                            <div className={`absolute inset-0 bg-gradient-to-br ${currentData.accentColor} opacity-40 mix-blend-multiply`}></div>
                            <div className="absolute inset-0 bg-gradient-to-t from-slate-950 via-slate-950/50 to-transparent"></div>
                            
                            <div className="absolute bottom-0 w-full p-6 md:p-10 pb-8 space-y-4 max-w-4xl">
                                <h1 className="text-4xl md:text-6xl font-extrabold text-white">{currentData.title}</h1>
                                <p className="text-sm md:text-lg text-slate-200">{currentData.context}: {currentData.task}</p>
                                <button onClick={handleStartActivity} className={`bg-white text-black font-bold py-3 px-4 rounded-lg flex items-center gap-2`}>
                                    <Play className="w-5 h-5" /> Lanjut Belajar
                                </button>
                            </div>
                        </div>

                        {/* Delta Stages */}
                        <div className={`px-4 md:px-10 mt-6 md:mt-8 ${getHighlightClass(2)}`}>
                             <h3 className="text-white font-bold mb-4">Tahapan DELTA</h3>
                             <div className="flex overflow-x-auto gap-4 pb-8">
                                {deltaStages.map((stage) => (
                                    <div key={stage.id} onClick={() => setActiveDeltaStage(stage.id)} className={`flex-none w-40 h-56 rounded-xl border-2 border-slate-700 bg-slate-900 p-4 flex flex-col justify-end cursor-pointer ${activeDeltaStage === stage.id ? `border-${currentData.themeColor}-500` : ''}`}>
                                        <h4 className="text-white font-bold">{stage.title}</h4>
                                        <p className="text-xs text-slate-400">{stage.subtitle}</p>
                                    </div>
                                ))}
                             </div>
                        </div>
                        
                        {/* Content Detail */}
                        <div className={`px-4 md:px-10 mb-8 max-w-6xl ${getHighlightClass(3)}`}>
                            <div className="bg-slate-900 border border-slate-800 rounded-2xl p-6">
                                <h3 className="text-xl font-bold text-white mb-2">Aktivitas: {activeDeltaStage}</h3>
                                <p className="text-slate-300 text-sm mb-4">Detail aktivitas untuk tahapan ini.</p>
                                <button onClick={() => callGeminiAPI('project')} className="py-3 px-6 rounded-xl font-bold bg-indigo-600 text-white flex items-center gap-2">
                                    <Sparkles className="w-4 h-4" /> Tanya Mentor AI
                                </button>
                            </div>
                        </div>
                    </div>
                );
            };

            // --- TOUR OVERLAY ---
            const TourOverlay = () => {
                const steps = [
                    { title: "Selamat Datang!", desc: "Mari kita lihat fitur utama Delta Pemantik.", position: "center" },
                    { title: "Pilih Materi", desc: "Materi pembelajaran aktif.", position: "top" },
                    { title: "Alur DELTA", desc: "5 Tahapan belajar.", position: "middle" },
                    { title: "Aktivitas", desc: "Tempat mengerjakan tugas.", position: "center" },
                    { title: "Pengumuman", desc: "Cek info sekolah.", position: "bottom-right" },
                ];
                const current = steps[tourStep];
                
                const handleNext = () => {
                    if (tourStep < steps.length - 1) setTourStep(tourStep + 1);
                    else setIsTourActive(false);
                };

                return (
                    <div className="fixed inset-0 z-[200] bg-black/50 backdrop-blur-sm animate-fadeIn" onClick={handleNext}>
                        <div className={`fixed p-6 bg-white text-slate-900 rounded-2xl shadow-2xl max-w-xs border-4 border-indigo-500 z-[202] top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2`}>
                            <h3 className="font-bold text-lg">{current.title}</h3>
                            <p className="text-sm">{current.desc}</p>
                            <button className="mt-4 bg-indigo-600 text-white px-4 py-2 rounded text-xs font-bold w-full">Lanjut</button>
                        </div>
                    </div>
                );
            };

            if (!isLoggedIn) {
                return (
                    <div className="min-h-screen bg-slate-950 text-white font-sans flex items-center justify-center p-6">
                        <div className="w-full max-w-md bg-slate-900/60 backdrop-blur-xl p-8 rounded-3xl border border-slate-800 relative">
                            {isDataLoading && <div className="absolute inset-0 bg-slate-900/80 z-20 flex items-center justify-center rounded-3xl"><Loader2 className="w-8 h-8 animate-spin text-blue-500"/></div>}
                            <h1 className="text-3xl font-bold text-center mb-2">Delta Pemantik</h1>
                            <p className="text-center text-slate-400 text-sm mb-6">Platform Pembelajaran Matematika SMK Interaktif & Inovatif</p>
                            
                            <form onSubmit={handleLogin} className="space-y-4">
                                <select className="w-full bg-slate-800 border border-slate-600 rounded-xl px-4 py-3 text-sm text-white" value={selectedClassLogin} onChange={handleClassChange} disabled={isDataLoading}>
                                    <option value="">-- Pilih Kelas --</option>
                                    {classList.map((c, i) => <option key={i} value={c}>{c}</option>)}
                                </select>
                                <select className="w-full bg-slate-800 border border-slate-600 rounded-xl px-4 py-3 text-sm text-white" value={selectedNameLogin} onChange={(e)=>setSelectedNameLogin(e.target.value)} disabled={!selectedClassLogin}>
                                    <option value="">-- Pilih Nama --</option>
                                    {availableNames.map((n, i) => <option key={i} value={n}>{n}</option>)}
                                </select>
                                <input type="password" className="w-full bg-slate-800 border border-slate-600 rounded-xl px-4 py-3 text-sm text-white" placeholder="Password" value={inputPassword} onChange={(e)=>setInputPassword(e.target.value)} disabled={!selectedNameLogin} />
                                {loginError && <p className="text-red-400 text-xs">{loginError}</p>}
                                <button type="submit" className="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 rounded-xl disabled:opacity-50" disabled={!selectedNameLogin}>Mulai Belajar</button>
                                <button type="button" onClick={handleGuestLogin} className="w-full border border-slate-600 text-slate-300 py-3 rounded-xl hover:bg-slate-800 text-sm">Masuk sebagai Tamu (Demo)</button>
                            </form>
                            {/* Floating Admin Button on Login */}
                            <button onClick={()=>setShowAdminModal(true)} className="absolute bottom-4 right-4 p-2 bg-red-600/80 rounded-full text-white"><Globe className="w-4 h-4"/></button>
                        </div>
                        {showAdminModal && (
                            <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4">
                                <div className="bg-slate-900 p-6 rounded-2xl w-full max-w-xs border border-slate-700">
                                    <h3 className="text-white font-bold mb-4">Admin Access</h3>
                                    <input type="password" className="w-full bg-slate-800 border border-slate-600 rounded p-2 text-white mb-2" placeholder="Password" value={adminPassword} onChange={(e)=>setAdminPassword(e.target.value)} />
                                    {adminError && <p className="text-red-500 text-xs mb-2">{adminError}</p>}
                                    <div className="flex gap-2">
                                        <button onClick={handleAdminAccess} className="flex-1 bg-red-600 text-white py-2 rounded font-bold">Go</button>
                                        <button onClick={()=>setShowAdminModal(false)} className="flex-1 bg-slate-700 text-white py-2 rounded">Cancel</button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-slate-950 text-slate-200 font-sans flex flex-col md:flex-row">
                    <aside className="hidden md:flex flex-col w-64 h-screen fixed left-0 top-0 bg-slate-900 border-r border-slate-800 z-50">
                        <div className="p-6 border-b border-slate-800"><h1 className="font-bold text-white text-xl">Delta Pemantik</h1></div>
                        <nav className="flex-1 p-4 space-y-2">
                            <button onClick={()=>setActiveTab('dashboard')} className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl ${activeTab==='dashboard'?'bg-blue-900/30 text-blue-400 border border-blue-500/30':''}`}><Menu className="w-5 h-5"/> Beranda</button>
                            <button onClick={()=>setActiveTab('teacher')} className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl ${activeTab==='teacher'?'bg-blue-900/30 text-blue-400 border border-blue-500/30':''}`}><GraduationCap className="w-5 h-5"/> Profil Guru</button>
                            <button onClick={()=>setActiveTab('announcements')} className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl ${activeTab==='announcements' || (isTourActive && tourStep===4)?`bg-blue-900/30 text-blue-400 border border-blue-500/30 ${getHighlightClass(4)}`:''}`}><Bell className="w-5 h-5"/> Pengumuman</button>
                        </nav>
                        <div className="p-4 border-t border-slate-800"><button onClick={()=>setIsLoggedIn(false)} className="w-full flex items-center gap-2 text-red-400"><LogOut className="w-4 h-4"/> Keluar</button></div>
                    </aside>

                    <main className="flex-1 w-full md:ml-64 min-h-screen bg-slate-950 relative flex flex-col">
                        <div className="md:hidden p-4 flex justify-between items-center bg-slate-900/80 backdrop-blur z-20 sticky top-0">
                            <span className="font-bold text-white">Delta Pemantik</span>
                            <div className="flex gap-2">
                                <button onClick={()=>setIsLoggedIn(false)} className="text-red-400"><LogOut className="w-5 h-5"/></button>
                            </div>
                        </div>
                        
                        <div className="flex-1 relative">
                            {renderContent()}
                        </div>
                    </main>

                    {/* Modals & Overlays */}
                    {isTourActive && <TourOverlay />}
                    {showAIModal && (
                        <div className="fixed inset-0 z-[100] bg-black/80 flex items-center justify-center p-4">
                            <div className="bg-slate-900 w-full max-w-md p-6 rounded-2xl border border-slate-700">
                                <h3 className="text-white font-bold mb-2">Mentor AI</h3>
                                <div className="bg-slate-800 p-4 rounded-xl text-sm text-slate-300 min-h-[100px] mb-4">
                                    {aiLoading ? <div className="flex items-center gap-2"><Loader2 className="w-4 h-4 animate-spin"/> Berpikir...</div> : aiResponse}
                                </div>
                                <button onClick={()=>setShowAIModal(false)} className="w-full bg-slate-700 text-white py-2 rounded-lg">Tutup</button>
                            </div>
                        </div>
                    )}
                     {showActivityModal && activityContent && (
                        <div className="fixed inset-0 z-[100] bg-black/80 flex items-center justify-center p-4">
                            <div className="bg-slate-900 w-full max-w-md rounded-2xl border border-slate-700 overflow-hidden">
                                <div className="h-24 bg-blue-900/50 flex items-center justify-center">{activityContent.icon}</div>
                                <div className="p-6">
                                    <h3 className="text-white font-bold text-xl mb-2">{activityContent.title}</h3>
                                    <p className="text-slate-300 text-sm mb-6 whitespace-pre-line">{activityContent.body}</p>
                                    <button onClick={()=>setShowActivityModal(false)} className="w-full bg-blue-600 text-white py-3 rounded-xl font-bold">{activityContent.actionText}</button>
                                </div>
                            </div>
                        </div>
                    )}

                    <nav className="md:hidden fixed bottom-0 w-full bg-[#121212] border-t border-slate-800 p-2 flex justify-around z-40">
                         <button onClick={()=>setActiveTab('dashboard')} className="text-white p-2"><Menu/></button>
                         <button onClick={()=>setActiveTab('teacher')} className="text-white p-2"><GraduationCap/></button>
                         <button onClick={()=>setActiveTab('announcements')} className={`text-white p-2 ${getHighlightClass(4)}`}><Bell/></button>
                    </nav>

                     <button onClick={()=>setShowAdminModal(true)} className={`fixed bottom-20 right-4 z-50 p-3 bg-red-600 rounded-full text-white shadow-lg ${getHighlightClass(4)}`}><Globe className="w-5 h-5"/></button>
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
